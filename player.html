<script src="js/devmodeforplayer.js"></script>
<script src='js/DisableDevTool.js'></script>
<link rel="stylesheet" href="css/player.css">

<div id="page">
  <section id="social">
<table
  id="player"
  style="
    color: #fff;
    font-family: Helvetica, Arial;
    font-size: 5vmin;
    border-radius: 10px;
    width: 100%;
    height: 100%;
  "
>
  <tr height="100%">
    <td width="20%" align="center">
      <img
        id="player-album-art"
        style="margin: 1em; max-height: 50vmin; border-radius: 10px"
      />
    </td>
    <td width="80%">
      <div style="margin: 1em 1em 1em 0">
        <div id="player-song" style="font-size: 2em"></div>
        <div
          id="player-artist"
          style="font-size: 1.3em; margin-bottom: 1em"
        ></div>
       
        <div id="player-status" style="margin: 2em 0 1em 0"></div>
        <div
          id="player-time"
          style="position: relative; float: right; top: -2em; font-weight: bold"
        ></div>
        <div
          id="player-progress-back"
          style="border: 0.15em solid #eee; height: 1em; border-radius: 10px"
        >
          <div
            id="player-progress"
            style="
              background-color: #eee;
              border: 0.1em solid transparent;
              height: 0.75em;
              border-radius: 10px;
              transition: width 0.2s;
            "
          ></div>
        </div>
        <div style="float: right; font-size: 0.9em">

@ardaxefe

        </div>
      </div>
    </td>
  </tr>
</table>
</section>
</div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

<script>

function formatTime(milliseconds) {
    // Toplam süreyi saniye cinsine çevir
    const totalSeconds = milliseconds / 1000;

    // Dakikaları ve saniyeleri hesapla
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = Math.floor(totalSeconds % 60);

    // Dakika ve saniye değerlerini stringe dönüştür
    const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
    const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;

    // Biçimlendirilmiş zamanı döndür
    return `${formattedMinutes}:${formattedSeconds}`;
}

function test123(artistList, maxChars) {
    if (!artistList) return artistList;

    const artists = artistList.split(';').map(artist => artist.trim());
    const totalLength = artists.reduce((acc, curr) => acc + curr.length, 0);

    if (artists.length === 1) {
        return artists.map(artist => `<a href="https://open.spotify.com/intl-tr/search/${encodeURIComponent(artist)}" target="_blank">${artist}</a>`).join(', ');
    } else if (totalLength > maxChars) {
        return "Various Artists";
    } else {
        return artists.map(artist => `<a href="https://open.spotify.com/intl-tr/search/${encodeURIComponent(artist)}" target="_blank">${artist}</a>`).join(', ');
    }
}

function updatePlayer() {
    $.getJSON("https://api.lanyard.rest/v1/users/647900446664687617", (data) => {
        const spotifyData = data.data.spotify;

        if (!spotifyData) {
            document.getElementById("player-song").innerHTML = `arda is not listening to music right now.`;
            document.getElementById("player-artist").innerHTML = "  ";
            document.getElementById("player-status").innerHTML = null;
            document.getElementById("player-album-art").setAttribute("src", " ");
            document.getElementById("player-progress").style.display = "none";
            document.getElementById("player-progress-back").style.display = "none";
            document.getElementById("player-time").innerHTML = null;
            return;
        }

        document.getElementById("player-song").innerHTML = `<a href="https://open.spotify.com/intl-tr/track/${spotifyData.track_id}" target="_blank">${spotifyData.song}</a>`;
        document.getElementById("player-artist").innerHTML = test123(spotifyData.artist, 30);
        document.getElementById("player-status").innerHTML = `▶️ arda listening...`;
        document.getElementById("player-album-art").setAttribute("src", spotifyData.album_art_url);

        const currentTime = Date.now();
        const startTime = spotifyData.timestamps.start;
        const endTime = spotifyData.timestamps.end;
        const duration = endTime - startTime;
        const elapsedTime = currentTime - startTime;
        const progress100 = (elapsedTime / duration) * 100;

        document.getElementById("player-progress").style.display = "block";
        document.getElementById("player-progress-back").style.display = "block";

        document.getElementById("player-progress").style.width = `${progress100}%`;
        const currentSong = formatTime(elapsedTime);
        const endOkunabilir = formatTime(duration);
        document.getElementById("player-time").innerHTML = `${currentSong} - ${endOkunabilir}`;
    });
}

  
  // Oynatıcıyı Yükle ve Güncelle
  updatePlayer();
  setInterval(updatePlayer, 1000);
  
  </script>
